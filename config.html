<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Skagen Watchface Settings</title>
  <style>
    body { font-family: sans-serif; margin: 2em; background: #f4f4f4; }
    label { display: block; margin-top: 1em; }
    select { margin-left: 1em; }
    .button { margin-top: 2em; padding: 1em 2em; font-size: 1.2em; }
  </style>
</head>
<body>
  <h2>Skagen Watchface Settings</h2>
  <form id="config-form">
    <label>Background color:
      <select id="BG_COLOR">
        <option value="#000000">Black</option>
        <option value="#FFFFFF">White</option>
        <option value="#FF0000">Red</option>
        <option value="#FFFF00">Yellow</option>
        <option value="#00FF00">Green</option>
        <option value="#0000FF">Blue</option>
        <option value="#00FFFF">Cyan</option>
        <option value="#808080">Gray</option>
        <option value="#FF00FF">Magenta</option>
        <option value="#FFC0CB">Pink</option>
      </select>
    </label>
    <label>Time color:
      <select id="TIME_COLOR">
        <option value="#FFFFFF">White</option>
        <option value="#000000">Black</option>
        <option value="#FF0000">Red</option>
        <option value="#FFFF00">Yellow</option>
        <option value="#00FF00">Green</option>
        <option value="#0000FF">Blue</option>
        <option value="#00FFFF">Cyan</option>
        <option value="#808080">Gray</option>
        <option value="#FF00FF">Magenta</option>
        <option value="#FFC0CB">Pink</option>
      </select>
    </label>
    <label>Weather color:
      <select id="WEATHER_COLOR">
        <option value="#FFFFFF">White</option>
        <option value="#000000">Black</option>
        <option value="#FF0000">Red</option>
        <option value="#FFFF00">Yellow</option>
        <option value="#00FF00">Green</option>
        <option value="#0000FF">Blue</option>
        <option value="#00FFFF">Cyan</option>
        <option value="#808080">Gray</option>
        <option value="#FF00FF">Magenta</option>
        <option value="#FFC0CB">Pink</option>
      </select>
    </label>
    <label>Date color:
      <select id="DATE_COLOR">
        <option value="#FFFFFF">White</option>
        <option value="#000000">Black</option>
        <option value="#FF0000">Red</option>
        <option value="#FFFF00">Yellow</option>
        <option value="#00FF00">Green</option>
        <option value="#0000FF">Blue</option>
        <option value="#00FFFF">Cyan</option>
        <option value="#808080">Gray</option>
        <option value="#FF00FF">Magenta</option>
        <option value="#FFC0CB">Pink</option>
      </select>
    </label>
    <label>Pebble battery color:
      <select id="BATTERY_COLOR">
        <option value="#FFFFFF">White</option>
        <option value="#000000">Black</option>
        <option value="#FF0000">Red</option>
        <option value="#FFFF00">Yellow</option>
        <option value="#00FF00">Green</option>
        <option value="#0000FF">Blue</option>
        <option value="#00FFFF">Cyan</option>
        <option value="#808080">Gray</option>
        <option value="#FF00FF">Magenta</option>
        <option value="#FFC0CB">Pink</option>
      </select>
    </label>
    <label>Phone battery color:
      <select id="PHONE_BATTERY_COLOR">
        <option value="#FFFFFF">White</option>
        <option value="#000000">Black</option>
        <option value="#FF0000">Red</option>
        <option value="#FFFF00">Yellow</option>
        <option value="#00FF00">Green</option>
        <option value="#0000FF">Blue</option>
        <option value="#00FFFF">Cyan</option>
        <option value="#808080">Gray</option>
        <option value="#FF00FF">Magenta</option>
        <option value="#FFC0CB">Pink</option>
      </select>
    </label>
    <label>Notification dot color:
      <select id="NOTIFICATION_DOT_COLOR">
        <option value="#FF0000">Red</option>
        <option value="#FFFFFF">White</option>
        <option value="#000000">Black</option>
        <option value="#FFFF00">Yellow</option>
        <option value="#00FF00">Green</option>
        <option value="#0000FF">Blue</option>
        <option value="#00FFFF">Cyan</option>
        <option value="#808080">Gray</option>
        <option value="#FF00FF">Magenta</option>
        <option value="#FFC0CB">Pink</option>
      </select>
    </label>
    <label>Step bar color:
      <select id="STEPBAR_COLOR">
        <option value="#FF0000">Red</option>
        <option value="#FFFFFF">White</option>
        <option value="#000000">Black</option>
        <option value="#FFFF00">Yellow</option>
        <option value="#00FF00">Green</option>
        <option value="#0000FF">Blue</option>
        <option value="#00FFFF">Cyan</option>
        <option value="#808080">Gray</option>
        <option value="#FF00FF">Magenta</option>
        <option value="#FFC0CB">Pink</option>
      </select>
    </label>
    <label>Step bar background color:
      <select id="STEPBAR_BG_COLOR">
        <option value="#FFFFFF">White</option>
        <option value="#000000">Black</option>
        <option value="#FF0000">Red</option>
        <option value="#FFFF00">Yellow</option>
        <option value="#00FF00">Green</option>
        <option value="#0000FF">Blue</option>
        <option value="#00FFFF">Cyan</option>
        <option value="#808080">Gray</option>
        <option value="#FF00FF">Magenta</option>
        <option value="#FFC0CB">Pink</option>
      </select>
    </label>
    <label>Night mode (8:00 PM - 7:00 AM):
      <select id="NIGHT_MODE">
        <option value="0">Disabled</option>
        <option value="1">Enabled</option>
      </select>
    </label>
    <label>OpenWeather API Key:
      <input type="text" id="API_KEY" placeholder="Your API key (optional)" style="width: 300px;">
    </label>
    <label>Location method:
      <select id="LOCATION_METHOD">
        <option value="gps">GPS (automatic)</option>
        <option value="manual">Manual location</option>
      </select>
    </label>
    <label>Manual location (city, country):
      <input type="text" id="MANUAL_LOCATION" placeholder="e.g. Berlin, Germany" style="width: 300px;">
    </label>
    <label>Show phone battery:
      <select id="PHONE_BATTERY_ENABLED">
        <option value="1">Enabled</option>
        <option value="0">Disabled (Pebble battery only)</option>
      </select>
    </label>
    <div style="margin: 1em 0; padding: 1em; background: #e8f4f8; border-left: 4px solid #2196F3;">
      <strong>Phone battery requires PebbleBattery App:</strong><br>
      <span style="word-break: break-all; font-family: monospace; color: #333; background: #f5f5f5; padding: 2px 4px; border-radius: 3px; display: inline-block; margin: 0.5em 0;">
        https://github.com/p-ta/Skagen_Pebble_Watchface/blob/main/PebbleBatteryService.apk
      </span><br>
      <small>Without this app, only the Pebble battery will be shown.</small>
    </div>
    <button type="submit" class="button">Save & send to Pebble</button>
  </form>
  <script>
    // Aktuelle Einstellungen aus localStorage laden
    window.addEventListener('load', function() {
      // Gespeicherte Einstellungen laden, falls vorhanden
      var savedConfig = localStorage.getItem('skagenConfig');
      if (savedConfig) {
        try {
          var config = JSON.parse(savedConfig);
          // Einstellungen in die Formulare eintragen
          if (config.bg_color) document.getElementById('BG_COLOR').value = config.bg_color;
          if (config.time_color) document.getElementById('TIME_COLOR').value = config.time_color;
          if (config.weather_color) document.getElementById('WEATHER_COLOR').value = config.weather_color;
          if (config.date_color) document.getElementById('DATE_COLOR').value = config.date_color;
          if (config.battery_color) document.getElementById('BATTERY_COLOR').value = config.battery_color;
          if (config.phone_battery_color) document.getElementById('PHONE_BATTERY_COLOR').value = config.phone_battery_color;
          if (config.notification_dot_color) document.getElementById('NOTIFICATION_DOT_COLOR').value = config.notification_dot_color;
          if (config.stepbar_color) document.getElementById('STEPBAR_COLOR').value = config.stepbar_color;
          if (config.stepbar_bg_color) document.getElementById('STEPBAR_BG_COLOR').value = config.stepbar_bg_color;
          if (config.night_mode !== undefined) document.getElementById('NIGHT_MODE').value = config.night_mode;
          if (config.api_key) document.getElementById('API_KEY').value = config.api_key;
          if (config.location_method) document.getElementById('LOCATION_METHOD').value = config.location_method;
          if (config.manual_location) document.getElementById('MANUAL_LOCATION').value = config.manual_location;
          console.log("Gespeicherte Einstellungen geladen");
        } catch (e) {
          console.log("Fehler beim Laden der Einstellungen:", e);
        }
      }
    });

    function getQueryParam(variable) {
      var query = window.location.search.substring(1);
      var vars = query.split('&');
      for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split('=');
        if (decodeURIComponent(pair[0]) === variable) {
          return decodeURIComponent(pair[1]);
        }
      }
      return null;
    }

    const pebbleColors = {
      "#000000": 0xC0, // Schwarz
      "#FFFFFF": 0xFF, // Weiß
      "#FF0000": 0xE0, // Rot
      "#FFFF00": 0xFC, // Gelb
      "#00FF00": 0xD8, // Grün
      "#0000FF": 0xC3, // Blau
      "#00FFFF": 0xDF, // Cyan
      "#808080": 0xAA, // Grau
      "#FF00FF": 0xE3, // Magenta
      "#FFC0CB": 0xF3  // Pink
    };

    document.getElementById('config-form').onsubmit = function(e) {
      e.preventDefault();
      
      // Einstellungen für localStorage vorbereiten
      var configForStorage = {
        bg_color: document.getElementById('BG_COLOR').value,
        time_color: document.getElementById('TIME_COLOR').value,
        weather_color: document.getElementById('WEATHER_COLOR').value,
        date_color: document.getElementById('DATE_COLOR').value,
        battery_color: document.getElementById('BATTERY_COLOR').value,
        phone_battery_color: document.getElementById('PHONE_BATTERY_COLOR').value,
        notification_dot_color: document.getElementById('NOTIFICATION_DOT_COLOR').value,
        stepbar_color: document.getElementById('STEPBAR_COLOR').value,
        stepbar_bg_color: document.getElementById('STEPBAR_BG_COLOR').value,
        night_mode: parseInt(document.getElementById('NIGHT_MODE').value),
        api_key: document.getElementById('API_KEY').value,
        location_method: document.getElementById('LOCATION_METHOD').value,
        manual_location: document.getElementById('MANUAL_LOCATION').value
      };
      
      // Einstellungen im localStorage speichern
      localStorage.setItem('skagenConfig', JSON.stringify(configForStorage));
      
      var config = {
        3: pebbleColors[document.getElementById('BG_COLOR').value],             // BG_COLOR
        4: pebbleColors[document.getElementById('TIME_COLOR').value],           // TIME_COLOR
        5: pebbleColors[document.getElementById('WEATHER_COLOR').value],        // WEATHER_COLOR
        6: pebbleColors[document.getElementById('DATE_COLOR').value],           // DATE_COLOR
        7: pebbleColors[document.getElementById('BATTERY_COLOR').value],        // BATTERY_COLOR
        8: pebbleColors[document.getElementById('PHONE_BATTERY_COLOR').value],  // PHONE_BATTERY_COLOR
        9: pebbleColors[document.getElementById('STEPBAR_COLOR').value],        // STEPBAR_COLOR
        18: pebbleColors[document.getElementById('NOTIFICATION_DOT_COLOR').value], // NOTIFICATION_DOT_COLOR
        11: pebbleColors[document.getElementById('STEPBAR_COLOR').value],        // STEPBAR_COLOR
        12: parseInt(document.getElementById('NIGHT_MODE').value),              // NIGHT_MODE
        14: document.getElementById('API_KEY').value,                           // API_KEY
        15: document.getElementById('LOCATION_METHOD').value,                   // LOCATION_METHOD
        16: document.getElementById('MANUAL_LOCATION').value                    // MANUAL_LOCATION
      };
      var return_to = getQueryParam('return_to');
      var locationStr = return_to ? decodeURIComponent(return_to) : 'pebblejs://close#';
      document.location = locationStr + encodeURIComponent(JSON.stringify(config));
    };
  </script>
</body>
</html> 
